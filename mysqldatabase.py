import mysql.connector

class Sample:
    def __init__(self,id,IP,name,hash_SHA256,Pre):
        self.id = id
        self.IP = IP
        self.name = name
        self.hash_SHA256 = hash_SHA256
        self.Pre = Pre

# Them du lieu vao bang
def add_data_into_database(result):
    # Kết nối đến MySQL
    conn = mysql.connector.connect(
        host="localhost",
        user="myuser",
        password="QLong2k3!"
    )

    # Tạo đối tượng cursor
    cursor = conn.cursor()

    # Sử dụng cơ sở dữ liệu mới tạo
    cursor.execute("USE mydatabase")

    # Thêm bản ghi vào bảng
    sql = "INSERT INTO result_pre (id, IP, name, hash_SHA256, Pre ) VALUES (%s, %s, %s, %s, %s)"
    val = [
        (result.id, result.IP, result.name, result.hash_SHA256, result.Pre),
    ]

    cursor.executemany(sql, val)

    # Lưu các thay đổi
    conn.commit()

    # In ra số lượng bản ghi đã thêm
    print(cursor.rowcount, "bản ghi đã được thêm.")

    # Đóng kết nối
    conn.close()

# Tim du lieu theo id
def get_data_from_id(result_id):
    # Kết nối đến MySQL
    conn = mysql.connector.connect(
        host="localhost",
        user="myuser",
        password="QLong2k3!"
    )

    # Tạo đối tượng cursor
    cursor = conn.cursor()

    # Sử dụng cơ sở dữ liệu mới tạo
    cursor.execute("USE mydatabase")

    sql = "SELECT * FROM result_pre WHERE id = %s"
    var = (result_id,)

    cursor.execute(sql,var)

    result = cursor.fetchone()
    if result:
        return Sample(result[0],result[1],result[2],result[3],result[4])
    else :
        return None
    
# Tim du lieu theo hash_SHA256
def get_data_from_hash(hash):
    # Kết nối đến MySQL
    conn = mysql.connector.connect(
        host="localhost",
        user="myuser",
        password="QLong2k3!"
    )

    # Tạo đối tượng cursor
    cursor = conn.cursor()

    # Sử dụng cơ sở dữ liệu mới tạo
    cursor.execute("USE mydatabase")

    sql = "SELECT * FROM result_pre WHERE hash_SHA256 = %s LIMIT 1"
    var = (hash,)

    cursor.execute(sql,var)

    result = cursor.fetchone()
    
    if result:
        return Sample(result[0],result[1],result[2],result[3],result[4])
    else :
        return None
    
def get_last_id():
     # Kết nối đến MySQL
    conn = mysql.connector.connect(
        host="localhost",
        user="myuser",
        password="QLong2k3!"
    )

    # Tạo đối tượng cursor
    cursor = conn.cursor()

    # Sử dụng cơ sở dữ liệu mới tạo
    cursor.execute("USE mydatabase")

    sql = "SELECT id FROM result_pre ORDER BY id DESC LIMIT 1"

    cursor.execute(sql)

    result = cursor.fetchone()
    
    return result[0]