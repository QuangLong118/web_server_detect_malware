import yara

from Rule_list import get_files_in_folder

def matches_warning (data) :
    # Khởi tạo danh sách để lưu trữ các kết quả khớp
    matches_warning = []

    # Khởi tạo đường dẫn đến luật
    rule_paths = get_files_in_folder('yara-warning')

    # Xét từng rule
    for rule_file in rule_paths:
        rule = yara.compile(filepath = rule_file)
        # Thực hiện quy tắc trên dữ liệu và lấy danh sách kết quả khớp
        matches_temp = rule.match(data=data)
        # Thêm các kết quả khớp vào dang sách
        for match in matches_temp:
            matches_warning.append(match)
    # Nếu danh sách trống trả về None
    if not matches_warning :
        return None   
            
    # Tạo kết quả
    # Warnings = set()
    # for match in matches_warning:
    #     meta_info = match.meta
    #     Warnings.add(meta_info.get("warning"))
    #     thread = float(meta_info.get("thread","0"))
    #     if(thread > thread_warning):
    #         thread_warning=thread
    # Xuất kết quả
    
    # Trả về danh sách dấu hiệu tấn công khớp với mẫu thử
    return matches_warning

