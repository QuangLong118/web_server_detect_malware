import yara

from Rule_list import get_files_in_folder

def detect_malware(data):
    
    # Khởi tạo đường dẫn đến luật
    rule_paths = get_files_in_folder('Yara-malware')
    # Khởi tạo danh sách để lưu trữ các kết quả khớp
    matches_malware = []
    # Xét từng rule
    for rule_file in rule_paths:
        rule = yara.compile(filepath = rule_file)
        # Thực hiện quy tắc trên dữ liệu và lấy danh sách kết quả khớp
        matches_temp = rule.match(data=data)
        # Thêm các kết quả khớp vào dang sách
        for match in matches_temp:
            matches_malware.append(match)
    # Nếu danh sách trống trả về None
    if not matches_malware :
        return None     
    # Tạo kết quả mẫu mã độc khớp với mẫu thử
    return matches_malware

